{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reporter = exports.formatValidationErrors = exports.formatValidationError = exports.TYPE_MAX_LEN = void 0;\n/**\n * An [io-ts Reporter](https://gcanti.github.io/io-ts/modules/Reporter.ts.html#reporter-interface).\n *\n * @example\n *\n * import * as t from 'io-ts';\n * import Reporter from 'io-ts-reporters';\n *\n * const User = t.interface({ name: t.string });\n *\n * assert.deepEqual(\n *   Reporter.report(User.decode({ nam: 'Jane' })),\n *   ['Expecting string at name but instead got: undefined'],\n * )\n * assert.deepEqual( Reporter.report(User.decode({ name: 'Jane' })), [])\n *\n * @since 1.2.0\n */\nvar A = require(\"fp-ts/lib/Array\");\nvar E = require(\"fp-ts/lib/Either\");\nvar NEA = require(\"fp-ts/lib/NonEmptyArray\");\nvar O = require(\"fp-ts/lib/Option\");\nvar R = require(\"fp-ts/lib/Record\");\nvar pipeable_1 = require(\"fp-ts/lib/pipeable\");\nvar t = require(\"io-ts\");\nvar utils_1 = require(\"./utils\");\nvar isUnionType = function (_a) {\n  var type = _a.type;\n  return type instanceof t.UnionType;\n};\nvar jsToString = function (value) {\n  return value === undefined ? 'undefined' : JSON.stringify(value);\n};\nvar keyPath = function (ctx) {\n  // The context entry with an empty key is the original\n  // type (\"default context\"), not a type error.\n  return ctx.map(function (c) {\n    return c.key;\n  }).filter(Boolean).join('.');\n};\n// The actual error is last in context\nvar getErrorFromCtx = function (validation) {\n  // https://github.com/gcanti/fp-ts/pull/544/files\n  return A.last(validation.context);\n};\nvar getValidationContext = function (validation) {\n  // https://github.com/gcanti/fp-ts/pull/544/files\n  return validation.context;\n};\n/**\n * @category internals\n * @since 1.2.1\n */\nexports.TYPE_MAX_LEN = 160; // Two lines of 80-col text\nvar truncateType = function (type, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  var _a = options.truncateLongTypes,\n    truncateLongTypes = _a === void 0 ? true : _a;\n  if (truncateLongTypes && type.length > exports.TYPE_MAX_LEN) {\n    return type.slice(0, exports.TYPE_MAX_LEN - 3) + \"...\";\n  }\n  return type;\n};\nvar errorMessageSimple = function (expectedType, path, error, options) {\n  // https://github.com/elm-lang/core/blob/18c9e84e975ed22649888bfad15d1efdb0128ab2/src/Native/Json.js#L199\n  return [\"Expecting \" + truncateType(expectedType, options), path === '' ? '' : \"at \" + path, \"but instead got: \" + jsToString(error.value), error.message ? \"(\" + error.message + \")\" : ''].filter(Boolean).join(' ');\n};\nvar errorMessageUnion = function (expectedTypes, path, value, options) {\n  // https://github.com/elm-lang/core/blob/18c9e84e975ed22649888bfad15d1efdb0128ab2/src/Native/Json.js#L199\n  return ['Expecting one of:\\n', expectedTypes.map(function (type) {\n    return \"    \" + truncateType(type, options);\n  }).join('\\n'), path === '' ? '\\n' : \"\\nat \" + path + \" \", \"but instead got: \" + jsToString(value)].filter(Boolean).join('');\n};\n// Find the union type in the list of ContextEntry\n// The next ContextEntry should be the type of this branch of the union\nvar findExpectedType = function (ctx) {\n  return pipeable_1.pipe(ctx, A.findIndex(isUnionType), O.chain(function (n) {\n    return A.lookup(n + 1, ctx);\n  }));\n};\nvar formatValidationErrorOfUnion = function (path, errors, options) {\n  var expectedTypes = pipeable_1.pipe(errors, A.map(getValidationContext), A.map(findExpectedType), A.compact);\n  var value = pipeable_1.pipe(expectedTypes, A.head, O.map(function (v) {\n    return v.actual;\n  }), O.getOrElse(function () {\n    return undefined;\n  }));\n  var expected = expectedTypes.map(function (_a) {\n    var type = _a.type;\n    return type.name;\n  });\n  return expected.length > 0 ? O.some(errorMessageUnion(expected, path, value, options)) : O.none;\n};\nvar formatValidationCommonError = function (path, error, options) {\n  return pipeable_1.pipe(error, getErrorFromCtx, O.map(function (errorContext) {\n    return errorMessageSimple(errorContext.type.name, path, error, options);\n  }));\n};\nvar groupByKey = NEA.groupBy(function (error) {\n  return pipeable_1.pipe(error.context, utils_1.takeUntil(isUnionType), keyPath);\n});\nvar format = function (path, errors, options) {\n  return NEA.tail(errors).length > 0 ? formatValidationErrorOfUnion(path, errors, options) : formatValidationCommonError(path, NEA.head(errors), options);\n};\n/**\n * Format a single validation error.\n *\n * @category formatters\n * @since 1.0.0\n */\nexports.formatValidationError = function (error, options) {\n  return formatValidationCommonError(keyPath(error.context), error, options);\n};\n/**\n * Format validation errors (`t.Errors`).\n *\n * @example\n * import * as E from 'fp-ts/lib/Either'\n * import * as t from 'io-ts'\n * import { formatValidationErrors } from 'io-ts-reporters'\n *\n * const result = t.string.decode(123)\n *\n * assert.deepEqual(\n *   E.mapLeft(formatValidationErrors)(result),\n *   E.left(['Expecting string but instead got: 123'])\n * )\n *\n * @category formatters\n * @since 1.2.0\n */\nexports.formatValidationErrors = function (errors, options) {\n  return pipeable_1.pipe(errors, groupByKey, R.mapWithIndex(function (path, errors) {\n    return format(path, errors, options);\n  }), R.compact, R.toArray, A.map(function (_a) {\n    var _key = _a[0],\n      error = _a[1];\n    return error;\n  }));\n};\n/**\n * Deprecated, use the default export instead.\n *\n * @category deprecated\n * @deprecated\n * @since 1.0.0\n */\nexports.reporter = function (validation, options) {\n  return pipeable_1.pipe(validation, E.mapLeft(function (errors) {\n    return exports.formatValidationErrors(errors, options);\n  }), E.fold(function (errors) {\n    return errors;\n  }, function () {\n    return [];\n  }));\n};\nvar prettyReporter = {\n  report: exports.reporter\n};\nexports.default = prettyReporter;","map":{"version":3,"mappings":"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","names":["isUnionType","_a","type","t","UnionType","jsToString","value","undefined","JSON","stringify","keyPath","ctx","map","key","filter","Boolean","join","getErrorFromCtx","validation","last","context","getValidationContext","exports","truncateType","options","truncateLongTypes","length","slice","errorMessageSimple","expectedType","path","error","message","errorMessageUnion","expectedTypes","findExpectedType","A","findIndex","O","chain","lookup","n","formatValidationErrorOfUnion","errors","pipeable_1","compact","head","actual","getOrElse","expected","name","some","none","formatValidationCommonError","errorContext","groupByKey","NEA","groupBy","utils_1","format","tail","R","mapWithIndex","toArray","_key","E","mapLeft","fold","prettyReporter","report"],"sourceRoot":"","sources":["../../src/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}